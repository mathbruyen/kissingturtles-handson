<!doctype html>
<html lang="en">
  <head>
  <style>
    stop.begin { stop-color:yellow; }
    stop.end { stop-color:green; }
    body.invalid stop.end { stop-color:red; }
    #err { display:none; }
    body.invalid #err { display:inline; }
  </style>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1024" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>Kissing Turtles</title>
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:regular,semibold,italic,italicsemibold|PT+Sans:400,700,400italic,700italic|PT+Serif:400,700,400italic,700italic" rel="stylesheet" />
    <link href="css/slides.css" rel="stylesheet" />
    <link href="css/prism.css" rel="stylesheet" />
    <link rel="shortcut icon" href="favicon.png" />
  </head>
    <body class="impress-not-supported">

    <div class="fallback-message">
      <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
      <p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p>
    </div>

    <div id="impress">
      <!-- Show an overview of the presentation -->
      <div id="my-overview" class="step" data-x="0" data-y="0" data-scale="12">
      </div>

      <!-- Introduction section overview -->
      <div id="introduction" class="step section" data-x="0" data-y="-3000" data-scale="3">
        <h2>Introduction</h2>
      </div>

      <!-- Canvas -->
      <div id="canvas" class="step section" data-x="2953" data-y="-327" data-scale="3">
        <h2>Canvas</h2>
      </div>

      <div id="canvas-html" class="step slide" data-x="1963" data-y="-477" data-scale="0.6">
        <h2>HTML Element</h2>
        <pre><code class="language-markup">&lt;canvas
  id="mycanvas"
  width="1200" height="600"
  style="width: 600px; height: 300px;"&gt;
&lt;/canvas&gt;</code></pre>
        <canvas id="htmlcanvas" width="600" height="300" style="position: absolute; bottom: 1em; right: 1em; width: 600px; height: 300px; box-shadow: 1px 1px 12px #555"></canvas>
        <script>
(function () {
  var canvas = document.getElementById('htmlcanvas');
  var ctx = canvas.getContext('2d');

  var step = 10;
  ctx.lineWidth = 2;
  ctx.font = 'italic 20px Calibri';
  ctx.strokeStyle = 'red';
  ctx.fillStyle = 'blue';

  ctx.beginPath();

  ctx.moveTo(2 * step, 2 * step);
  ctx.lineTo(2 * step, canvas.height - (2 * step));
  ctx.lineTo(step, canvas.height - (3 * step));
  ctx.moveTo(2 * step, canvas.height - (2 * step));
  ctx.lineTo(3 * step, canvas.height - (3 * step));
  ctx.textAlign = 'left';
  ctx.textBaseline = 'middle';
  ctx.fillText('y', 4 * step, canvas.height - (3 * step));

  ctx.moveTo(2 * step, 2 * step);
  ctx.lineTo(canvas.width - (2 * step), 2 * step);
  ctx.lineTo(canvas.width - (3 * step), step);
  ctx.moveTo(canvas.width - (2 * step), 2 * step);
  ctx.lineTo(canvas.width - (3 * step), 3 * step);
  ctx.textAlign = 'center';
  ctx.textBaseline = 'top';
  ctx.fillText('x', canvas.width - (3 * step), 4 * step);

  ctx.textAlign = 'left';
  ctx.textBaseline = 'top';
  ctx.fillText('(0, 0)', 3 * step, 3 * step);

  ctx.moveTo(canvas.width - step, canvas.height - (2 * step));
  ctx.lineTo(canvas.width - (3 * step), canvas.height - (2 * step));
  ctx.moveTo(canvas.width - (2 * step), canvas.height - step);
  ctx.lineTo(canvas.width - (2 * step), canvas.height - (3 * step));
  ctx.textAlign = 'right';
  ctx.textBaseline = 'bottom';
  ctx.fillText('(width, height)', canvas.width - (3 * step), canvas.height - (3 * step));

  ctx.stroke();
})();
        </script>
      </div>

      <div id="canvas-js" class="step slide" data-x="2623" data-y="-477" data-scale="0.6">
        <h2>Interracting with javascript</h2>
        <pre><code class="language-javascript">var canvas = document.getElementById('mycanvas');
var ctx = canvas.getContext('2d');

// Scale [0,1]
var h = canvas.height;
var w = canvas.width;
var scaleX = function (x) { return x * w; };
var scaleY = function (y) { return y * h; };

// Or

// Force
var w = $(canvas).width();
var h = $(canvas).height();
canvas.width = w;
canvas.height = h;</code></pre>
      </div>

      <div id="canvas-path" class="step slide" data-x="3283" data-y="-477" data-scale="0.6">
        <h2>Basic: drawing paths</h2>
        <div class="livedemo">
          <pre><code class="language-javascript">ctx.beginPath();

ctx.moveTo(25, 25);
ctx.lineTo(405, 45);
ctx.bezierCurveTo(200,290, 10, 250, 80, 100);

ctx.strokeStyle = 'green';
ctx.lineCap = 'round';
ctx.lineWidth = 20;
ctx.stroke();</code></pre>
          <canvas width="500" height="300"></canvas>
        </div>
      </div>

      <div id="canvas-fillingpaths" class="step slide" data-x="3943" data-y="-477" data-scale="0.6">
        <h2>Filling paths</h2>
        <div class="livedemo">
          <pre><code class="language-javascript">ctx.beginPath();

ctx.moveTo(25, 25);
ctx.lineTo(405, 45);
ctx.bezierCurveTo(200, 250, 10, 290, 80, 100);
ctx.closePath();

ctx.fillStyle = 'rgba(10, 10, 230, 0.3)';
ctx.fill();

ctx.lineWidth = 5;
ctx.strokeStyle = 'red';
ctx.stroke();</code></pre>
          <canvas width="500" height="300"></canvas>
        </div>
      </div>

      <div id="canvas-fill" class="step slide" data-x="3943" data-y="3" data-scale="0.6">
        <h2>Shortcut - drawing shapes</h2>
        <div class="livedemo">
          <pre><code class="language-javascript">ctx.lineWidth = 5;
ctx.strokeStyle = 'green';
ctx.fillStyle = 'red';

ctx.beginPath();
ctx.rect(325, 25, 100, 100);
ctx.fill();

ctx.beginPath();
ctx.arc(200, 200, 50, 0, 2 * Math.PI);
ctx.fill();

ctx.stroke();</code></pre>
          <canvas width="500" height="300"></canvas>
        </div>
      </div>

      <div id="canvas-scenery" class="step slide" data-x="3943" data-y="483" data-scale="0.6">
        <h2>Draw background!</h2>
        <p>I want to see some kind of grid</a></p>
        <p>Edit <a href="../canvas/ktDrawBackground.js">ktDrawBackground.js</a></p>
        <p>Test in <a href="../canvas/background.html">background.html</a></p>
        <canvas id="backgroundcanvas1" width="300" height="300" style="position: absolute; bottom: 1em; left: 1em; box-shadow: 1px 1px 12px #555"></canvas>
        <canvas id="backgroundcanvas2" width="300" height="300" style="position: absolute; bottom: 1em; right: 1em; box-shadow: 1px 1px 12px #555"></canvas>
        <script>
(function () {
  var canvas1 = document.getElementById('backgroundcanvas1');
  var ctx1 = canvas1.getContext('2d');
  var canvas2 = document.getElementById('backgroundcanvas2');
  var ctx2 = canvas2.getContext('2d');
  var grid = 10;
  ctx2.translate(canvas2.width / (grid * 2), canvas2.height / (grid * 2));
  for (var i = 0; i < grid; i++) {
    for (var j = 0; j < grid; j++) {
      ctx1.beginPath();
      ctx1.fillStyle = ((i + j) % 2 === 0) ? 'red' : 'blue';
      ctx1.rect(i * canvas1.width / grid, j * canvas1.height / grid, canvas1.width / grid, canvas1.height / grid);
      ctx1.fill();

      ctx2.beginPath();
      ctx2.strokeStyle = 'green';
      ctx2.moveTo(i * canvas2.width / grid, 0);
      ctx2.lineTo(i * canvas2.width / grid, (grid - 1) * canvas2.height / grid);
      ctx2.moveTo(0, j * canvas2.height / grid);
      ctx2.lineTo((grid - 1) * canvas2.width / grid, j * canvas2.height / grid);
      ctx2.stroke();
    }
  }
})();
        </script>
      </div>

      <div id="canvas-origin" class="step slide" data-x="3283" data-y="483" data-scale="0.6">
        <h2>Playing with origin</h2>
        <div class="livedemo">
          <pre><code class="language-javascript">ctx.save();

ctx.translate(250, 150);
ctx.rotate(Math.PI / 6);
ctx.scale(2, 2);

ctx.beginPath();
ctx.rect(-50, -50, 100, 100);

ctx.lineWidth = 5;
ctx.strokeStyle = 'green';
ctx.fillStyle = 'red';
ctx.fill();
ctx.stroke();

ctx.restore();</pre></code>
          <canvas width="400" height="300"></canvas>
        </div>
      </div>

      <div id="canvas-bitmaps" class="step slide" data-x="2623" data-y="483" data-scale="0.6">
        <h2>Include a bitmap</h2>
        <div class="livedemo">
          <pre><code class="language-javascript">var image = new Image();
image.onload = function () {
  ctx.save();
  ctx.translate(150, 150);
  ctx.rotate(Math.PI / 8);
  ctx.scale(2, 2);
  ctx.drawImage(image, -16, -16, 32, 32)
  ctx.restore();
};
image.src = 'images/tree.png';</pre></code>
          <canvas width="300" height="250"></canvas>
        </div>
      </div>

      <div id="canvas-singleframe" class="step slide" data-x="1963" data-y="483" data-scale="0.6">
        <h2>Let's draw a single frame</h2>
        <a href="../canvas/ktDraw.js">Edit</a>
        <a href="../canvas/frame.html">Test</a>
      </div>

      <div id="canvas-animationbackground" class="step slide" data-x="1963" data-y="3" data-scale="0.6">
        <h2>How to animate</h2>
        <pre><code class="language-javascript">var duration = 1000;

var from = { x: 1, y: 1 };
var to = { x: 3, y: 4 };

var progress = (Date.now() - startTime) / duration;
if (progress >= 1) {
  drawAt(to.x, to.y);
  // Stop
} else {
  drawAt(
    from.x + (to.x - from.x) * progress,
    from.y + (to.y - from.y) * progress
  );
  // Redo at next frame
}</code></pre>
      </div>

      <div id="canvas-requestanimationframe" class="step slide" data-x="2623" data-y="3" data-scale="0.6">
        <h2>requestAnimationFrame</h2>
          <pre><code class="language-javascript">function iterate(timestamp) {
  var progress = computeProgress(timestamp);
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (progress > 1) {
    drawAt(1);
  } else {
    window.requestAnimationFrame(iterate);
    drawAt(progress);
  }
}
window.requestAnimationFrame(iterate);</pre></code>
      </div>

      <div id="canvas-animation" class="step slide" data-x="3283" data-y="3" data-scale="0.6">
        <h2>Let's animate</h2>
        <a href="../canvas/ktAnimate.js">Edit</a>
        <a href="../canvas/animate.html">Test</a>
      </div>

      <!-- Scaffolding -->
      <div id="scaffolding" class="step section" data-x="1763" data-y="2427" data-scale="3">
        <h2>Scaffolding</h2>
      </div>

      <div id="scaffolding-1" class="step slide" data-x="773" data-y="2277" data-scale="0.6">
        <h2>Set-up</h2>
        <div style="font-size: 20px">
        <b>Software required</b><br/>
        grails2.1+<br/>
        html5-mobile-scaffold<br/>
        <b>KissingTurtlesGreach Step by Step</b><br/>
        <pre> &gt; git clone https://github.com/corinnekrych/KissingTurtlesGreach.git</pre>
        <span style="font-size: 20px;"><img width="30" src="images/Warning-icon.png" alt="warning" /><b> Don't loose your hard work</b></span><br/>
        Before getting code from github branches, backup!<br/>
        <pre> &gt; git checkout step1</pre>
        <b>KissingTurtles tutorial</b><br/>
        <pre> &gt; git clone https://github.com/mathbruyen/kissingturtles-handson.git</pre>
        </div>
      </div>

    
      <div id="scaffolding-2" class="step slide" data-x="1433" data-y="2277" data-scale="0.6">
        <h2>Kissing Turtles</h2>
        <div style="float: left; font-size: 20px; text-align: left; display: inline-block; width: 30%"><br/>
        <p>Intiative started in november for Grails48</p><img width="70" src="images/g48_logo10.png" alt="grails48"/>
        <p>Game for kids to learn programming</p>
        <p>Simple Groovy DSL to make the turtle move</p>        
        </div>
        <div style="float:right;font-size:30px;text-align:right;display:inline-block;">
            <iframe src="http://kissingturtles.cloudfoundry.com" width="500" height="600" name="myFrame" id="myFrame"></iframe>
        </div>
    </div>

      <div id="scaffolding-3" class="step slide" data-x="2093" data-y="2277" data-scale="0.6">
        <h2>New project</h2><br/>
        <div style="font-size: 20px">
        <b>Create a new Grails app</b>
        <pre> &gt; grails create-app KissingTurtlesGreach</pre>
        <b>Integrate with you favourite editor ;-) </b>
        <pre> &gt; grails integrate-with --intellij</pre>
        <b>Only one domain class needed</b>
        <pre> &gt; grails create-domain-class kissingturtles.Game</pre>
        add attribute to your domain class:<br/>
        String name<br/>
      </div>
      </div>

      <div id="scaffolding-4" class="step slide" data-x="2753" data-y="2277" data-scale="0.6">
        <h2>Step1: Scaffold with ...</h2>
        <div style="display:inline-block;float:left;width:60%">
        <a href="http://3musket33rs.github.com/">3musket33rs plugin</a>
        <div style="font-size: 20px">
        <b>1: Plugin dependencies</b> in BuildConfig.groovy
<pre>grails.plugin.location."html5-mobile-scaffolding" = <br/>"../html5-mobile-scaffolding"</pre>
<b>2: New scaffold script</b><br/>
<pre> &gt;grails html-generate-all kissingturtles.Game
> grails run-app</pre>
<b>You're lost?</b>
<pre> &gt; git checkout step1</pre>
        </div>
        </div>
        <img style="width:40%" src="images/figures/figure0.png" alt="doc" />
      </div>

      <div id="scaffolding-5" class="step slide" data-x="2753" data-y="2751" data-scale="0.6">
        <h2>What was generated?</h2>
        <div style="font-size: 20px">
          => controllers<br/>
          => views generated in web-app folder: no GSP!<br/>
          2 parts js framework, grails.mobile package<br/>
          and your domain driven package: <b>kissingturtles.views.game-view.js</b><br/>
        </div>
        <img style="float:right;width:100%" src="images/figures/figure1.png" />
      </div>

      <div id="scaffolding-6" class="step slide" data-x="2753" data-y="3231" data-scale="0.6">
        <h2>Offline mode</h2>
        <div style="font-size: 20px">
<b>CRUD easy</b><br/>
Try CRUD oprations, add new game.<br/>
<b>Am I loosing my data offline?</b><br/> 
in js console type
<pre> &gt; localStorage</pre>
<b>Test it</b><br/>
1. turn off wifi or work offline menu in FF<br/>
2. add a new game<br/>
3. back offline<br/>
<b>Clear data</b><br/>
<pre> &gt; localStorage.clear()</pre>
        </div>
      </div>

      <div id="scaffolding-6-1" class="step slide" data-x="2800" data-y="3300" data-scale="0.05">
        <h2>Offline mode</h2>
        <img style="float:right;width:100%" src="images/figures/figure2.png" />
      </div>

      <div id="scaffolding-6-2" class="step slide" data-x="2950" data-y="3300" data-scale="0.05">
        <h2>Back online</h2>
        <img style="float:right;width:100%" src="images/figures/figure3.png" />
      </div>

      <div id="scaffolding-7" class="step slide" data-x="2093" data-y="3231" data-scale="0.6">
        <h2>Step2: Take just what we need...</h2>
        <div style="font-size: 20px;">
          1. in UrlMappings.groovy remove: "/"(view:"/index")<br/>
          2. in BuildConfig.groovy remove:
          <pre>compile ':cache:1.0.0'
          runtime ":resources:1.1.6"</pre>
          3. remove offline caching in game-bootstrap.js
          <pre> options: { 
            offline: false,
            eventPush: true 
          }</pre>
          4. Change view behaviour<br/>
          delete index.html<br/>
          rename game-index.html into index.html<br/>
          <b>You loose your path?</b><br/>
          <pre> &gt; git checkout step2</pre>
        </div>
      </div>

      <div id="scaffolding-8" class="step slide" data-x="1433" data-y="3231" data-scale="0.6">
        <h2>Step3: Redesign main page</h2>
        with HTML5<br/>
        <div style="float: left; font-size: 20px; text-align: left; display: inline-block; width: 40%">
          <b>Play button</b><br/>
          In indext.html add new section "start-game" with a button id=play
          <pre> &gt; git checkout step3</pre>
          to get images !<br/>
      </div>
          <div style="float:right;font-size:30px;text-align:right;display:inline-block;">
            <img src="images/mainpage.png"  width="400" height="500"/>
        </div>
      </div>
      
      <div id="scaffolding-8-1" class="step slide" data-x="1500" data-y="3300" data-scale="0.06">
      <div style="float: left; font-size: 20px;"> 
      <b>HTML section for start-game</b>
      <pre style="height:40%">
&lt;section data-role=&quot;page&quot; id=&quot;start-game&quot;&gt;<br/>    &lt;div data-role=&quot;header&quot; data-position=&quot;fixed&quot;&gt;<br/>        &lt;h1&gt;Kissing Turtles&lt;/h1&gt;<br/>    &lt;/div&gt;<br/><br/>    &lt;div class=&quot;center-wrapper&quot; data-role=&quot;content&quot; id=&quot;start-presentation&quot;&gt;<br/>        &lt;div&gt;<br/>            &lt;img width=&quot;20%&quot; src=&quot;images/game/turtle.png&quot;/&gt;<br/>            &lt;img width=&quot;20%&quot; src=&quot;images/game/pig.png&quot;/&gt;<br/>        &lt;/div&gt;<br/>        &lt;div data-theme=&quot;a&quot; class=&quot;center-wrapper&quot; data-content-theme=&quot;a&quot;&gt;<br/>            &lt;textarea readonly&gt;Franklin and Emily have a rendez-vous. Help them to meet at the love tree.&lt;/textarea&gt;&lt;/div&gt;<br/>        &lt;div&gt;<br/>            &lt;ul data-role=&quot;listview&quot; data-inset=&quot;true&quot;&gt;<br/>                &lt;li&gt;&lt;a id=&quot;play&quot; data-role=&quot;button&quot; data-inline=&quot;true&quot;&gt;Play&lt;/a&gt;&lt;/li&gt;<br/>            &lt;/ul&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/><br/>    &lt;div data-role=&quot;footer&quot; data-position=&quot;fixed&quot;&gt;<br/>        &lt;h4&gt;Greach 2013&lt;/h4&gt;<br/>    &lt;/div&gt;<br/>&lt;/section&gt;
      </pre>  
    </div>

      </div>

      <div id="scaffolding-9" class="step slide" data-x="773" data-y="3231" data-scale="0.6">
        <h2>Step4: Add dynamic behaviour</h2>
           with jQuery<br/>
        <div style="float: left; font-size: 20px; text-align: left; display: inline-block; width: 50%">
          <b>1. User name section</b><br/>
          Same than earlier... pure HTML5<br/>
          <b>Play button</b><br/>
          2. In <b>kissingturtles.views.game-view.js</b><br/>
          add click on play -> go to section-show-user<br/>
          store on local storage user name<br/>
          3. click on save user-> go to list<br/>
          <pre>
        $('#play').live('click tap', function (event) {
          //TO DO
         });
        $("#submit-user").live("click tap", function(event) {
          // TO DO save in localStorage
        });
          </pre>
      </div>
      <div style="float:right;font-size:30px;text-align:right;display:inline-block;">
            <img src="images/user_screen.png"  width="350"/>
        </div>
      </div>

      <div id="scaffolding-9-1" class="step slide" data-x="800" data-y="3300" data-scale="0.06">
      <div style="float: left; font-size: 20px;"> 
      <pre style="height:40%;width:80%">
&lt;section data-role=&quot;page&quot; id=&quot;section-show-user&quot;&gt;<br/>    &lt;div data-role=&quot;header&quot; id=&quot;show-user&quot; data-position=&quot;fixed&quot;&gt;<br/>        &lt;a href=&quot;#start-game&quot; data-transition=&quot;slide&quot; data-icon=&quot;arrow-l&quot;&gt;Cancel&lt;/a&gt;<br/>        &lt;h1&gt;Who are you?&lt;/h1&gt;<br/>    &lt;/div&gt;<br/>    &lt;ul data-role=&quot;listview&quot; data-inset=&quot;true&quot;&gt;<br/>        &lt;li data-role=&quot;fieldcontain&quot;&gt;<br/>            &lt;label for=&quot;input-user-name&quot;&gt;What's your name ?&lt;/label&gt;<br/>            &lt;input type=&quot;text&quot; class=&quot;validate[required]&quot; name=&quot;name&quot; id=&quot;input-user-name&quot; value=&quot;&quot;/&gt;<br/>        &lt;/li&gt;<br/>    &lt;/ul&gt;<br/><br/>    &lt;div data-role=&quot;footer&quot; data-position=&quot;fixed&quot;&gt;<br/>        &lt;div data-role=&quot;navbar&quot;&gt;<br/>            &lt;ul&gt;<br/>                &lt;li&gt;&lt;a href=&quot;&quot; data-role=&quot;button&quot; data-transition=&quot;slide&quot; data-icon=&quot;save&quot;<br/>                       id=&quot;submit-user&quot;&gt;Save&lt;/a&gt;&lt;/li&gt;<br/>            &lt;/ul&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/>&lt;/section&gt;
      </pre> 
      </div> 
    </div>

     <div id="scaffolding-9-2" class="step slide" data-x="900" data-y="3300" data-scale="0.06">
      <div style="float: left; font-size: 20px;"> 
      <b>Click on play</b>
      <pre>
    //----------------------------------------------------------------------------------------
    //   Click on Play brings you here
    //----------------------------------------------------------------------------------------
    $('#play').live('click tap', function (event) {
        var id = localStorage.getItem("KissingTurtles.UserId");
        if (id) {
            $.mobile.changePage($("#section-list-game"));
            that.listButtonClicked.notify();
        } else {
            $.mobile.changePage($("#section-show-user"));
        }
    });
</pre>
<b>Click on save user</b>
<pre>
    //----------------------------------------------------------------------------------------
    //   Click on Save on user page. Your name is asked only once.
    //----------------------------------------------------------------------------------------
    $("#submit-user").live("click tap", function(event) {
        var name = $('#input-user-name').val();
        localStorage.setItem("KissingTurtles.UserId", name);
        $.mobile.changePage($("#section-list-game"));
    });
</pre>
</div>
      </div>      

      <div id="scaffolding-10" class="step slide" data-x="773" data-y="2751" data-scale="0.6">
          <h2>Step4: Add canvas</h2>
          <div style="float: left; font-size: 20px;"> 
          <b>Create canvas</b><br/>
          3. in "section-show-game" section remove form element<br/>
          4. add canvas<br/>
          5. include ktDraw.js<br>
          6. window.onload to write in canvas<br>
          <b>Did you mess up?</b>
          <pre> &gt; git checkout step4</pre>
        </div>
      </div>

      <div id="scaffolding-11" class="step slide" data-x="1433" data-y="2751" data-scale="0.6">
        <h2>Step5: Adding server side call</h2>
        <div style="float: left; font-size: 20px;"> 
        <b>Adding behabiour for create button</b><br/>
        . get name from localStorage<br/>
        . notify controller of create
        <pre>
    $("#add-game").live('click tap', function (event) {
      //TO DO
    });
        </pre>
        <b>Server side GameController</b><br/>
        . generate walls<br/>
        . generate turtles random positions<br/>

        <b>Callback on created</b><br/>
        . initialize ktDraw<br/>
        . move to show-game section
        <pre>
    that.model.createdItem.attach(function (data, event) {
      //TO DO
    });
        </pre>  

        <b>Did you mess up?</b>
        <pre> &gt; git checkout step5</pre>
      </div>
      </div>

     <div id="scaffolding-11-1" class="step slide" data-x="1500" data-y="2751" data-scale="0.06">
      <div style="float: left; font-size: 20px;"> 
      <b>Click on create</b>
        <pre>
    //----------------------------------------------------------------------------------------
    //   Click on 'Create your own game' brings you here
    //----------------------------------------------------------------------------------------
    $("#add-game").live('click tap', function (event) {
        event.stopPropagation();
        var obj = {user1: localStorage.getItem("KissingTurtles.UserId")};
        var newElement = {
            game: JSON.stringify(obj)
        };
        that.createButtonClicked.notify(newElement, event);
    });
        </pre>
<b>Callback on created</b>
<pre>
    //----------------------------------------------------------------------------------------
    //   Callback after first player create a new game. First player will play as Franklin.
    //----------------------------------------------------------------------------------------
    that.model.createdItem.attach(function (data, event) {
        if (data.item.errors) {
            $.each(data.item.errors, function (index, error) {
                $('#input-game-' + error.field).validationEngine('showPrompt', error.message, 'fail');
            });
            event.stopPropagation();
        } else if (data.item.message) {
            showGeneralMessage(data, event);
        } else {
            var confAsString = data.item.mazeDefinition;
            var conf = JSON.parse(confAsString);

            that.currentMaze = conf;
            that.draw = ktDraw(document.getElementById('canvas'), conf, that.currentMaze.steps[0]);
            that.player = "franklin";
            that.gameId = data.item.id;

            renderElement(data.item);
            showElement(data.item);

            $("#list-game").listview('refresh');
            $.mobile.changePage($("#section-show-game"));
        }
    });
</pre>
</div>
      </div>   
    <div id="scaffolding-12" class="step slide" data-x="2093" data-y="2751" data-scale="0.6">
        <h2>Step6: I'd like to move it</h2>
        <div style="float: left; font-size: 20px;"> 
        <b>Adding behabiour for execute button</b><br/>
        

        <b>Server side GameController</b><br/>
        . move up by 3<br/>
        . is actual Grovvy code
        <pre>
        def run() {
        ...
          def binding = new Binding([
                  turtle: turtle,
                  left: dsl.Direction.left,
                  right: dsl.Direction.right,
                  down: dsl.Direction.down,
                  up: dsl.Direction.up,
                  move: turtle.&amp;move,
                  by: turtle.&amp;by
          ])
          def shell = new GroovyShell(binding)
          shell.evaluate(script)
          def result = binding.getVariable('turtle').result
        ... 
        </pre>
        <b>Did you mess up?</b>
        <pre> &gt; git checkout step6</pre>
      </div>      
    </div>

    <div id="scaffolding-12-1" class="step slide" data-x="2200" data-y="2751" data-scale="0.3">
      <div style="float: left; font-size: 20px;"> 
      <b>Click on execute</b>
        <pre>
    //----------------------------------------------------------------------------------------
    //   Click on Execute my DSL script brings you here
    //----------------------------------------------------------------------------------------
    $("#submit-game").live("click tap", function(event) {
        var dslInput = $('#input-move-name').val();
        var gameId = that.gameId;
        that.executeButtonClicked.notify({title: "KissingTurtles", 
          content: dslInput, 
          gameId: gameId, 
          user: localStorage.getItem("KissingTurtles.UserId")});
    });
        </pre>
<b>Callback on executed</b>
    <pre>
    //----------------------------------------------------------------------------------------
    //    Callback to display the maze after execute method
    //----------------------------------------------------------------------------------------
    that.model.executed.attach(function (data, event) {
        var myGameObject = data.item;
        $.each(myGameObject.configuration.steps, function (key, value) {
            that.draw(value, function () {
                var win = myGameObject.configuration.winningAnimation;
                if (win) {
                    that.draw.win(win.x, win.y);
                }
            });
        });
    });
   </pre>  
 </div>
</div>
    <div id="scaffolding-12bis" class="step slide" data-x="2093" data-y="2751" data-scale="0.6">
        <h2>Step6: I'd like to move it</h2>
        <div style="float: left; font-size: 20px;"> 
        <b>Adding behabiour for execute button</b><br/>
        

        <b>Server side GameController</b><br/>
        . move up by 3<br/>
        . is actual Grovvy code
        <pre>
        def run() {
        ...
          def binding = new Binding([
                  turtle: turtle,
                  left: dsl.Direction.left,
                  right: dsl.Direction.right,
                  down: dsl.Direction.down,
                  up: dsl.Direction.up,
                  move: turtle.&amp;move,
                  by: turtle.&amp;by
          ])
          def shell = new GroovyShell(binding)
          shell.evaluate(script)
          def result = binding.getVariable('turtle').result
        ... 
        </pre>
        <b>Did you mess up?</b>
        <pre> &gt; git checkout step6</pre>
      </div>      
    </div>
 
      <!-- Multiplayer -->
      <div id="multiplayer" class="step section" data-x="-1763" data-y="2427" data-scale="3">
        <h2>Multiplayer</h2>
      </div>
      <div id="multiplayer-1" class="step slide" data-x="-2753" data-y="2277" data-scale="0.6">
        <h2>Multi-Users, Real Time</h2>
        <div style="float: left; font-size: 20px; text-align: left; width: 850px;">
        <p>Let's add some more fun and make it a real-time multi-users applications.</p>
        <p style="font-size: 20px;color:pink;">First player (Franklin) is creating the game. The other player (Emily), joins the game...</p>

        <div style="display:inline-block;float:left;width: 400px;" >
            <iframe src="http://kissingturtles.cloudfoundry.com/" width="400" height="500" name="myFrame" id="myFrame-2"></iframe>
        </div>
        <div style="display:inline-block;float:left;width:25px"><br></div>

        <div style="display:inline-block;float:right;width: 400px;" >
            <iframe src="http://kissingturtles.cloudfoundry.com/" width="400" height="500" name="myFrame" id="myFrame-3"></iframe>
        </div>
        </div>
      </div>

    
      <div id="multiplayer-2" class="step slide" data-x="-2093" data-y="2277" data-scale="0.6">
        <h2>Event-push with Atmosphere</h2>
        <div style="float: left; font-size: 20px; text-align: left; display: inline-block; width: 30%"><br/>
        <p></p>
        <p></p>
        <p></p>        
        </div>
    </div>

      <div id="multiplayer-3" class="step slide" data-x="-1433" data-y="2277" data-scale="0.6">
        <h2>Step7: Franklin creates the game</h2>
        <div style="font-size: 20px">
        <b>Push is activated by default</b>
        <pre>options: {
            offline: false,
            eventPush: true
        }</pre>
        <b>Server side</b><br/>
        declare the events in grails-app/conf/GameEvents.groovy
        <pre>events = {
      'save-game' browser:true
      'update-game' browser:true
      'delete-game' browser:true
    }</pre>
        <b>In GameController, raise the event</b>
        <pre>event topic:"save-game", data: gameInstance</pre>
        <b>Client side processing</b><br/>
        in web-app/js/grails/mobile/push/pushmanager.js,<br/>
        <pre>grailsEvents.on('save-' + domainName , function (data) {
            if (!model.getItems()[data.id]) {
                data.NOTIFIED = true;
                if (options.offline) {
                    store.store(data);
                }
                model.createItem(data);
            }
        });</pre>
        </div>
      </div>

      <div id="multiplayer-4" class="step slide" data-x="-773" data-y="2277" data-scale="0.6">
        <h2>Step7: Franklin already knows...</h2>
        <div style="font-size: 20px">
        he doesn't want to be notified!<br/>
        <b>in web-app/js/grails/mobile/push/pushmanager.js</b><br/>
        <b>Back on created callback</b>
        <pre>
    //----------------------------------------------------------------------------------------
    //   Callback after first player create a new game. First player will play as Franklin.
    //----------------------------------------------------------------------------------------
    that.model.createdItem.attach(function (data, event) {
        if (data.item.errors) {
     ....
        } else {
        // TODO add check if we're notified data.item.NOTIFIED
        }
    });          
        </pre>
        </div>
      </div>

    <div id="multiplayer-5" class="step slide" data-x="-773" data-y="2751" data-scale="0.6">
      <h2>Step7: Franklin already knows...</h2>
      <div style="font-size: 20px">
        <b>Back on created callback</b>
        <pre>
    //----------------------------------------------------------------------------------------
    //   Callback after first player create a new game. First player will play as Franklin.
    //----------------------------------------------------------------------------------------
    that.model.createdItem.attach(function (data, event) {
        if (data.item.errors) {
            $.each(data.item.errors, function (index, error) {
                $('#input-game-' + error.field).validationEngine('showPrompt', error.message, 'fail');
            });
            event.stopPropagation();
        } else if (data.item.message) {
            showGeneralMessage(data, event);
        } else {
            var confAsString = data.item.mazeDefinition;
            var conf = JSON.parse(confAsString);
            if (!data.item.NOTIFIED) {
                that.currentMaze = conf;
                that.draw = ktDraw(document.getElementById('canvas'), conf, that.currentMaze.steps[0]);
                that.player = "franklin";
                that.gameId = data.item.id;
            }
            renderElement(data.item);
            showElement(data.item);

            $("#list-game").listview('refresh');
            if (!data.item.NOTIFIED) {
                $.mobile.changePage($("#section-show-game"));
            }
        }
    }); </pre>
        <b>Get latest from github?</b>
        <pre> &gt; git checkout step7</pre>
        </div>
    </div>

      <div id="multiplayer-6" class="step slide" data-x="-773" data-y="3231" data-scale="0.6">
        <h2>Step8: Emily joins</h2>
        <div style="font-size: 20px">
         Same idea with <b>update</b> event<br/>
         <b>1. write onclick</b> for element in the list<br/>
         get userId from localStorage and notify update<br/>
         <pre>
    that.elements.show.live('click tap', function (event) {
      //TO DO
    });</pre>
         <b>2. Server side</b><br/>
        declare the update-game event in grails-app/conf/GameEvents.groovy<br/>
        <b>3. In GameController, raise the update-game event</b><br/>
        <b>4. client side catching</b><br/>
        in web-app/js/grails/mobile/push/pushmanager.js,<br/>
        <b>5. Callback on updated</b><br/>
        to exclude myself from notification
      </div>
      </div>

      <div id="multiplayer-7" class="step slide" data-x="-1433" data-y="3231" data-scale="0.6">
        <h2>Step8: Emily joins</h2>
      <div style="font-size: 20px">
        <b>On click element of the list</b>
         <pre>
    //----------------------------------------------------------------------------------------
    //   Click on an element of the list to join the game. Second player is Emily.
    //----------------------------------------------------------------------------------------
    that.elements.show.live('click tap', function (event) {
        event.stopPropagation();
        var gameId = $(event.currentTarget).attr('data-id');
        if(gameId) {
            var obj = {user2: localStorage.getItem("KissingTurtles.UserId"), gameId: gameId};
            var newElement = {
                game: JSON.stringify(obj)
            };
            that.updateButtonClicked.notify(newElement, event);
        }
    });</pre>
        </div>
      </div>

      <div id="multiplayer-8" class="step slide" data-x="-2093" data-y="3231" data-scale="0.6">
        <h2>Step8: Emily joins</h2>
      <div style="font-size: 20px">
        <b>Callback on updated</b>
        <pre>
    //----------------------------------------------------------------------------------------
    //   Callback after joining the game
    //----------------------------------------------------------------------------------------
    that.model.updatedItem.attach(function (data, event) {
        if (data.item.errors) {
            $.each(data.item.errors, function(index, error) {
                $('#input-game-' + error.field).validationEngine('showPrompt',error.message, 'fail');
            });
            event.stopPropagation();
        } else if (data.item.message) {
            showGeneralMessage(data, event);
        } else {
            // In case of Emily or Franklin we go here
            var confAsString = data.item.mazeDefinition;
            var conf = JSON.parse(confAsString);
            that.currentMaze = conf;
            updateElement(data.item);

            if (!data.item.NOTIFIED) {
                // For Emily game, initialize canvas
                that.draw = ktDraw(document.getElementById('canvas'), conf, that.currentMaze.steps[0]);
                that.player = "emily";
                that.gameId = data.item.id;
                $.mobile.changePage($("#section-show-game"));
            } else if (that.player == "franklin" &amp;&amp; that.gameId == data.item.id) {
                // For Franklin game
                that.draw({emily: that.currentMaze.steps[0].emily});
            } else {
                $("#list-game").listview('refresh');
            }
        }
    });

        </pre>
        <b>Get latest from github?</b>
        <pre> &gt; git checkout step8</pre>
        </div>
      </div>
    

      <div id="multiplayer-9" class="step slide" data-x="-2753" data-y="3231" data-scale="0.6">
        <h2>Step9: My friend moves</h2>
        <div style="font-size: 20px">
        <b>1. Define new event</b> in grails-app/conf/GameEvents.groovy
        <pre>events = {
              'save-game' browser:true
              'update-game' browser:true
              'delete-game' browser:true
              "execute-game" browser: true
            }</pre>
        <b>2. GameController.execute</b>, raise event execute-game<br/>
        <b>3. Client side</b> catch event execute-game <br/>
        in manager-bootstap.js
        <pre>
    managerObject.domainsObjects['game'].push.grailsEvents.on('execute-game', function (data) {
        var dataParsed = JSON.parse(data);
        dataParsed.NOTIFIED = true;
        managerObject.domainsObjects['game'].model.execute(dataParsed);
    });</pre>
      </div>
      </div>     

      <div id="multiplayer-10" class="step slide" data-x="-2753" data-y="2751" data-scale="0.6">
         <h2>Step9: My friend moves</h2>
        <div style="font-size: 20px">
        <b>4. On executed</b> refresh canvas<br/>
        <pre>
    //----------------------------------------------------------------------------------------
    //    Callback to display the maze after execute method
    //----------------------------------------------------------------------------------------
    that.model.executed.attach(function (data, event) {
        // only for my game
        if (that.gameId == data.item.configuration.id) {
            // refresh me if it's not myself pls
            if (!data.item.NOTIFIED || that.player != data.item.configuration.player) {
                var myGameObject = data.item;
                $.each(myGameObject.configuration.steps, function(key, value) {
                    that.draw(value, function () {
                        var win = myGameObject.configuration.winningAnimation;
                        if (win) {
                            that.draw.win(win.x, win.y);
                        }
                    });
                });
            }
        }
    });
        </pre>
        <b>Get latest from github?</b>
        <pre> &gt; git checkout step9</pre>
      </div>
      </div>

      <!-- Conclusion -->
      <div id="conclusion" class="step section" data-x="-2953" data-y="-327" data-scale="3">
        <h2>Conclusion</h2>
        <div style="font-size: 20px">
        <b>Same your project in github (optional)</b><br/>
git init<br/>
git add -A<br/>
git commit -m "my changes"<br/>
git remote add origin https://github.com/yourGithubUsername/KissingTurtlesGreach.git<br/>
git push -u origin master<br/>
       </div>
      </div>
    </div>

    <div class="hint">
      <p>Use a spacebar or arrow keys to navigate</p>
    </div>
    <script>
(function () {
  function enhance (element) {
    var txt = element.querySelector('code');
    var canvas = element.querySelector('canvas');
    var ctx = canvas.getContext('2d');
    eval(txt.innerHTML);
  }
  var demos = document.querySelectorAll('.livedemo');
  for (var i = 0; i < demos.length; i++) {
    enhance(demos.item(i));
  }
})();
    </script>
    <script src="js/prism.js"></script>
    <script>
      if ("ontouchstart" in document.documentElement) { 
        document.querySelector(".hint").innerHTML = "<p>Tap on the left or right to navigate</p>";
      }
    </script>
    <script src="js/prism.js"></script>
    <script src="js/impress.js"></script>
    <script>impress().init();</script>
  </body>
</html>